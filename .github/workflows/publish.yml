name: Pinguino Publish

on: push

jobs:
  publish:

    runs-on: ubuntu-20.04

    steps:

      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Get Added Files
        id: files
        uses: jitterbit/get-changed-files@v1

      - name: Add Files to ENV Variable
        run: |
          for changed_file in ${{ steps.files.outputs.added }}; do
            echo "latest_build_url=https://github.com/JamCoreDiscord/builds/tree/main/${changed_file}" >> $GITHUB_ENV
          done

      - name: Make API Request
        run: |
          curl -X POST -H "Content-Type: application/json" -d '{"build_url": "${{  env.latest_build_url  }}"}' ${{  secrets.API_UPLOAD  }}